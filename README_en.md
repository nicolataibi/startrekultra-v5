# Star Trek Ultra: 3D Multi-User Client-Server Edition
## Star Trek Day, September 8, 2026, 60 years since the first airing of the original series in 1966.
### Nicola Taibi: https://github.com/nicolataibi/startrekultra-v5
**Persistent Galaxy Tactical Navigation & Combat Simulator**

<table>
  <tr>
    <td><img src="Enterprise.jpg" alt="USS Enterprise" width="400"/></td>
    <td><img src="einstein-rosen-schwarzschild.jpg" alt="Einstein-Rosen Schwarzschild Wormhole" width="400"/></td>
  </tr>
  <tr>
    <td><img src="pulsar.jpg" alt="Pulsar" width="400"/></td>
    <td><img src="nebula.jpg" alt="Nebula" width="400"/></td>
  </tr>
  <tr>
    <td><img src="wormhole-enter.jpg" alt="Wormhole Entry" width="400"/></td>
    <td><img src="wormhole-exit.jpg" alt="Wormhole Exit" width="400"/></td>
  </tr>
  <tr>
    <td><img src="shields.jpg" alt="Sector Shields" width="400"/></td>
    <td><img src="new cinematic engine 2026.jpg" alt="New Cinematic Engine 2026" width="400"/></td>
  </tr>
</table>

Star Trek Ultra is an advanced space simulator combining the strategic depth of classic 70s text-based "Trek" games with a modern Client-Server architecture and hardware-accelerated 3D visualization.

---

## üöÄ Quick Start Guide

### 1. Install Dependencies (Linux)
```bash
# Ubuntu / Debian
sudo apt-get install build-essential freeglut3-dev libglu1-mesa-dev libglew-dev libssl-dev

# Fedora / Red Hat
sudo dnf groupinstall "Development Tools"
sudo dnf install freeglut-devel mesa-libGLU-devel glew-devel openssl-devel
```

### 2. Build
Compile the project to generate the updated executables:
```bash
make
```

### 3. Start Server
Launch the secure startup script. You will be asked to set a **Master Key** (secret password for the server):
```bash
./run_server.sh
```

### 4. Start Client
In another terminal, launch the client:
```bash
./run_client.sh
```
**Login Flow:**
1.  **Server IP:** Enter the server address.
2.  **Handshake:** The client validates the Master Key. If incorrect, it exits immediately for security.
3.  **Identification:** Only if the link is secured, you will be asked for your **Commander Name**.
4.  **Configuration:** If it's your first time, you will select your Faction and Ship Class.

---

## ‚öôÔ∏è Configuration & Modding

Gameplay is entirely customizable via the centralized configuration file **`include/game_config.h`**.
By editing this file and recompiling with `make`, you can alter the physics and combat rules of your server.

Configurable parameters include:
*   **Resource Limits:** `MAX_ENERGY_CAPACITY`, `MAX_TORPEDO_CAPACITY`.
*   **Damage Balance:** `DMG_PHASER_BASE` (phaser power), `DMG_TORPEDO` (torpedo damage).
*   **Interaction Ranges:** `DIST_MINING_MAX` (mining range), `DIST_BOARDING_MAX` (transporter range for boarding).

| Operation | Command | Maximum Distance (Sector) |
| :--- | :--- | :--- |
| **Antimatter Harvest** | `har` | **3.1** |
| **Mineral Mining** | `min` | **3.1** |
| **Solar Scooping** | `sco` | **3.1** |
| **Boarding / Teams** | `bor` | **1.0** |
| **Starbase Docking** | `doc` | **3.1** |
| **Probe Recovery** | `aux recover` | **3.1** |

*Note: The operational safety distance from Black Holes is set to **3.0**. Crossing this threshold triggers gravitational pull and shield drain. The 3.1 interaction range allows for safe harvesting just outside the gravity well. A **0.05 unit tolerance** is implemented to compensate for autopilot decimal inaccuracies.*

*   **Events:** `TIMER_SUPERNOVA` (catastrophic countdown duration).

This allows admins to create custom game variants (e.g., *Hardcore Survival* with scarce resources or *Arcade Deathmatch* with overpowered weapons).

---

### üîê Security Architecture: "Dual-Layer" Protocol

Star Trek Ultra implements a military-grade security model designed to ensure communication secrecy even in hostile multi-team environments.

#### 1. The Concept
The system uses two distinct encryption layers to balance accessibility with tactical isolation:

1.  **Master Key (Shared Secret - KEK):**
    *   **Role:** Acts as a **Key Encryption Key (KEK)**. It doesn't encrypt game data directly but secures the tunnel where the Session Key is exchanged.
    *   **Integrity Verification:** The system uses a 32-byte "Magic Signature" (`HANDSHAKE_MAGIC_STRING`). During the handshake, the server attempts to decrypt this signature using the provided Master Key.
    *   **Tactical Rigor:** If even a single bit of the Master Key differs (e.g., "ciao" vs "ciao1"), the signature will be corrupted. The server detects the anomaly and **instantly severs the TCP connection**, logging a `[SECURITY ALERT]`.
    *   **Setup:** Requested at startup by the `run_server.sh` and `run_client.sh` scripts.

2.  **Session Key (Unique Ephemeral Key):**
    *   **Role:** 256-bit random cryptographic key generated by the client for each session.
    *   **Total Isolation:** Once the Master Key is validated, the server and client switch to the Session Key. This ensures that **every player/team is tuned to a different cryptographic frequency**, making one team's data inaccessible to others even if they share the same server.

#### 2. Secure Startup Guide

To ensure security is active, always use the provided bash scripts instead of launching the executables directly.

**Starting the Server:**
```bash
./run_server.sh
# You will be asked to enter a secret Master Key (e.g., "DeltaVega47").
# This key must be shared with all authorized players.
```

**Starting the Client:**
```bash
./run_client.sh
# Enter the SAME Master Key set on the server.
# The system will confirm: "Secure Link Established. Unique Frequency active."
```

#### 3. In-Game Encryption Commands
Once connected, security is active but transparent. Captains can choose the tactical encryption algorithm (the "flavor" of encryption) using the `enc` command:

*   `enc aes`: Activates AES-256-GCM (Starfleet Standard).
*   `enc chacha`: Activates ChaCha20-Poly1305 (High Speed).
*   `enc off`: Disables encryption (Cleartext traffic, not recommended).

*Note: If two players use different algorithms (e.g., one AES and the other ChaCha), they will not be able to read each other's radio messages, seeing only "static noise". This forces teams to coordinate communication frequencies.*

---

## üõ†Ô∏è System Architecture and Construction Details

The game is built on the **Subspace-Direct Bridge (SDB)** architecture, a hybrid communication model designed to eliminate bottlenecks typical of real-time multiplayer simulators.

### The Subspace-Direct Bridge (SDB) Model
This cutting-edge architecture solves latency and jitter problems typical of intensive multiplayer games by completely decoupling network synchronization from visualization fluidity. The SDB model transforms the client into an **Intelligent Tactical Relay**, optimizing remote traffic and zeroing out local latency.

1.  **Subspace Channel (TCP/IP Binary Link)**:
    *   **Role**: Authoritative synchronization of the galactic state.
    *   **Technology**: Proprietary binary protocol with dynamic **Interest Management**. The server calculates which objects are visible to the player and sends only necessary data, reducing bandwidth usage by up to 85%.
    *   **Features**: Implements variable-length packets and binary packing (`pragma pack(1)`) to eliminate padding and maximize efficiency on remote channels.

2.  **Direct Bridge (POSIX Shared Memory Link)**:
    *   **Role**: Zero-latency interface between local logic and the graphics engine.
    *   **Technology**: Shared memory segment (`/dev/shm`) mapped directly into the address spaces of the Client and Viewer.
    *   **Efficiency**: Uses a **Zero-Copy** approach. The Client writes data received from the server directly into SHM; the 3D Viewer consumes it instantly. Synchronization is guaranteed by POSIX semaphores and mutexes, allowing the graphics engine to run at a constant 60+ FPS, applying **Linear Interpolation (LERP)** to compensate for time gaps between network packets.

#### üîÑ Data Flow Pipeline (Tactical Propagation)
The effectiveness of the SDB model is visible by observing the journey of a single update (e.g., the movement of a Romulan Warbird):
1.  **Server Tick (Logic)**: The server calculates the enemy's new global position and updates the spatial index.
2.  **Subspace Pulse (Network)**: The server serializes the data into `PacketUpdate`, truncates it to include only objects in the player's quadrant, and sends it via TCP.
3.  **Client Relay (Async)**: The client's `network_listener` thread receives the packet, validates the `Frame ID`, and writes coordinates to **Shared Memory**.
4.  **Direct Bridge Signal (IPC)**: The client increments the `data_ready` semaphore.
5.  **Viewer Wake-up (Rendering)**: The viewer exits the *wait* state, acquires the mutex, copies the new coordinates as `target`, and starts LERP calculation to smoothly glide the vessel to the new position during subsequent graphic frames.

Thanks to this pipeline, terminal commands travel in "Subspace" with TCP security, while the tactical view on the bridge remains stable, fluid, and stutter-free, regardless of internet connection quality.

### 1. The Galactic Server (`trek_server`)
This is the game's "engine". It manages the entire universe of 1000 quadrants.
*   **Modular Logic**: Divided into modules (`galaxy.c`, `logic.c`, `net.c`, `commands.c`) to ensure maintainability and thread-safety.
*   **Spatial Partitioning**: Uses a 3D spatial index (Grid Index) for object management. This allows the server to scan only objects local to the player, guaranteeing constant performance ($O(1)$) regardless of the total number of entities in the galaxy.
*   **Persistence**: Saves the state of the entire universe, including player progress, in `galaxy.dat` with binary version control.

### 2. The Command Bridge (`trek_client`)
The `trek_client` represents the operational core of the user experience, acting as a sophisticated orchestrator between the human operator, the remote server, and the local rendering engine.

*   **Multi-Threaded Architecture**: The client simultaneously manages several data pipelines:
    *   A dedicated thread (**Network Listener**) constantly monitors the *Subspace Channel*, processing incoming packets from the server without blocking the interface.
    *   The main thread handles user input and immediate feedback on the terminal.
*   **Reactive Input Management (Reactive UI)**: Thanks to `termios` `raw` mode, the client intercepts individual keystrokes in real-time. This allows the player to receive radio messages, computer alerts, and tactical updates *while typing* a command, without the cursor or text being interrupted or garbled.
*   **Direct Bridge Orchestration**: The client is responsible for the shared memory (SHM) lifecycle. At startup, it creates the memory segment, initializes synchronization semaphores, and launches the `trek_3dview` process. Whenever it receives a `PacketUpdate` from the server, the client instantly updates the object matrix in SHM, notifying the viewer via POSIX signals.
*   **Identity & Persistence Hub**: Manages the login procedure and faction/class selection, interfacing with the server's persistent database to restore mission state.

In summary, `trek_client` transforms a simple text terminal into an advanced and fluid command bridge, typical of an LCARS interface.

### 3. The 3D Tactical View (`trek_3dview`)
The 3D viewer is a standalone rendering engine based on **OpenGL and GLUT**, designed to provide an immersive spatial representation of the surrounding tactical area and the entire galaxy.

*   **Cinematic Fluidity (LERP)**: To overcome the discrete nature of network packets, the engine implements **Linear Interpolation (LERP)** algorithms for both positions and orientations (Heading/Mark). Objects don't "jump" from point to point but glide smoothly through space, maintaining 60 FPS even if the server updates logic at a lower frequency.
*   **High-Performance Rendering**: Uses **Vertex Buffer Objects (VBO)** to handle thousands of background stars and the galactic grid, minimizing CPU calls and maximizing GPU throughput.
*   **Stellar Cartography (Map Mode)**:
    *   Activatable via the `map` command, this mode transforms the tactical view into a global 10x10x10 galactic map.
    *   Each quadrant is represented by chromatic indicators showing the density of bases (green), enemies (red), planets (cyan), black holes (purple), **nebulas (grey)**, and **pulsars (orange)**.
    *   Active **ion storms** are visualized as white energy shells surrounding the quadrant.
    *   The player's current position is highlighted by a **pulsing white indicator**, facilitating long-range navigation.
*   **Dynamic Tactical HUD**: Implements a 2D-on-3D projection (via `gluProject`) to anchor labels, health bars, and IDs directly above vessels. The overlay now includes real-time monitoring of **Crew (CREW)**, vital for mission survival.
*   **Effects Engine (VFX)**:
    *   **Trail Engine**: Each ship leaves a persistent ionic trail that helps visualize its movement vector.
    *   **Combat FX**: Real-time visualization of phaser beams managed via **GLSL Shaders**, photon torpedoes with dynamic glow, and volumetric explosions.
    *   **Dismantle Particles**: A dedicated particle system animates the dismantling of enemy wrecks during resource recovery operations.

The Tactical View is not just an aesthetic element but a fundamental tool for short-range combat and precision navigation between celestial bodies and environmental threats.

---

## üì° Communication Protocols

### Network (Server ‚Üî Client): The Subspace Channel
Remote communication is entrusted to a custom state-aware binary protocol, designed to ensure consistency and performance on networks with variable latency.

*   **Deterministic Binary Protocol**: Unlike text protocols (like JSON or XML), the Subspace Channel uses a **Binary-Only** architecture. Data structures are aligned via `pragma pack(1)` to eliminate compiler padding, ensuring every transmitted byte is useful information.
*   **State-Aware Synchronization**:
    *   The server doesn't just send positions but synchronizes the entire logical state needed by the client (energy, shields, inventory, onboard computer messages).
    *   Every update packet (`PacketUpdate`) includes a global **Frame ID**, allowing the client to correctly handle the temporal order of data.
*   **Interest Management & Delta Optimization**:
    *   **Spatial Filtering**: The server dynamically calculates each player's visibility set. You will only receive data on objects present in your current quadrant or affecting your long-range sensors, drastically reducing network load.
    *   **Truncated Updates**: Packets containing object lists (like enemy ships or debris) are physically truncated before sending. If there are only 2 ships in your quadrant, the server will send a packet containing only those 2 slots instead of the entire fixed array, saving precious KB every tick.
*   **Data Integrity & Stream Robustness**:
    *   Implements an **Atomic Read/Write** mechanism. The `read_all` and `write_all` functions ensure that, despite the "stream" nature of TCP, binary packets are reconstructed only when complete and intact, preventing logical state corruption during traffic spikes.
*   **Signal Multiplexing**: The protocol manages different packet types (`Login`, `Command`, `Update`, `Message`, `Query`) on the same socket, acting as a subspace signal multiplexer.

This implementation allows the simulator to scale smoothly, keeping command latency (Input Lag) minimal and galaxy consistency absolute for all connected captains.

### IPC (Client ‚Üî Viewer): The Direct Bridge
The link between the command bridge and the tactical view is realized via an inter-process communication (IPC) interface based on **POSIX Shared Memory**, designed to eliminate local data exchange latency.

*   **Shared-Memory Architecture**: The `trek_client` allocates a dedicated memory segment (`/st_shm_PID`) where the `GameState` structure resides. This structure acts as a mirror representation of the local state, accessible in real-time by both the client (writer) and the viewer (reader).
*   **Hybrid Synchronization (Mutex & Semaphores)**:
    *   **PTHREAD_PROCESS_SHARED Mutex**: Data consistency within shared memory is guaranteed by a mutex configured for cross-process use. This prevents the viewer from reading partial data while the client is updating the object matrix.
    *   **POSIX Semaphores**: A semaphore (`sem_t data_ready`) is used to implement a "Producer-Consumer" notification mechanism. Instead of constantly polling memory, the viewer remains in an efficient wait state until the client signals the availability of a new logical frame.
*   **Zero-Copy Efficiency**: Since data physically resides in the same RAM area mapped into both address spaces, passing telemetry parameters involves no additional memory copy (memcpy), maximizing system bus performance.
*   **Event Latching**: SHM handles "latching" of rapid events (like explosions or phaser discharges). The client deposits the event in memory, and the viewer, after rendering it, resets the flag, ensuring no tactical effect is lost or duplicated.
*   **Lifecycle Orchestration**: The client acts as a supervisor, managing creation (`shm_open`), sizing (`ftruncate`), and final destruction of the IPC resource, ensuring the system leaves no memory orphans in case of a crash.

This approach transforms the 3D viewer into a pure reactive graphics slave, allowing the rendering engine to focus exclusively on visual fluidity and geometric calculation.

---

## üîç Technical Specifications

Star Trek Ultra is not just a tactical simulator but a complex software architecture implementing advanced design patterns for distributed state management and real-time calculation.

### 1. The Core Logic Engine (Tick-Based Simulation)
The server operates on a deterministic loop at **30 Ticks Per Second (TPS)**. Each logic cycle follows a rigorous pipeline:
*   **Input Reconciliation**: Processing of atomic commands received from clients via epoll.
*   **Predictive AI Update**: Calculation of movement vectors for NPCs based on pursuit matrices and tactical weights (faction, residual energy).
*   **Spatial Indexing (Grid Partitioning)**: Objects are not iterated linearly ($O(N)$), but mapped into a 10x10x10 three-dimensional grid. This reduces collision and sensor complexity to ($O(1)$) for the player's local area.
*   **Physics Enforcement**: Application of galactic clamping and collision resolution with static celestial bodies.

### 2. ID-Based Object Tracking & Shared Memory Mapping
The object tracking system uses a **Persistent Identifier** architecture:
*   **Server Side**: Each entity (ship, star, planet) has a unique global ID. During the tick, only IDs visible to the player are serialized.
*   **Client/Viewer Side**: The viewer maintains a local buffer of 200 slots. Through an **implicit Hash Map**, the client associates the server ID with an SHM slot. If an ID disappears from the network packet, the *Stale Object Purge* system instantly invalidates the local slot, ensuring visual consistency without timeout latency.

### 3. Advanced Networking Model (Atomic Binary Stream)
To ensure stability under high-frequency updates, the simulator implements:
*   **Atomic Packet Delivery:** Each client connection is protected by a dedicated `socket_mutex`. This ensures that large data packets (like the Galaxy Master) are never interleaved with logic update packets, eliminating binary stream corruption and race conditions.
*   **Binary Layout Consistency:** All network structures exclusively use fixed-size types (`int32_t`, `int64_t`, `float`). Combined with `pragma pack(1)`, this ensures the protocol is identical across different CPU architectures and compiler versions.
*   **Synchronous Security Handshake:** Connections are not established blindly. The server performs synchronous validation of a 32-byte signature before sending any sensitive data, providing a robust logical firewall.

### 4. Memory Management & Server Stability
*   **Heap-Based Command Processing:** Sensor scan functions (`srs`, `lrs`) utilize dynamic Heap allocation (`calloc`/`free`) to handle data buffers exceeding 64KB. This prevents *Stack Overflow* risks, ensuring server stability even in ultra-high density quadrants.
*   **Zero-Copy Shared Memory (Realigned):** IPC now uses explicit sector coordinates (`shm_s`) for player positioning, eliminating ID-lookup latency in the 3D viewer and ensuring pixel-perfect camera tracking.

### 5. GLSL Rendering Pipeline (Hardware-Accelerated Aesthetics)
The 3D viewer implements a programmable shading pipeline:
*   **Vertex Stage**: Handling of HUD projection transformations and per-pixel light vector calculation.
*   **Fragment Stage**:
    *   **Aztek Shader**: Procedural generation of hull textures based on fragment coordinates, eliminating the need for external graphic assets.
    *   **Fresnel Rim Lighting**: Calculation of the dot product between normal and view vector to highlight vessel structural profiles.
    *   **Plasma Flow Simulation**: Temporal animation of emissive parameters to simulate energy flow in warp nacelles.

### 6. Robustness and Session Continuity
*   **Atomic Save-State**: The `galaxy.dat` database is updated via periodic flushes with global mutex locking, ensuring a consistent memory snapshot.
*   **Emergency Rescue Protocol**: A heuristic rescue logic intervenes at login to resolve error states (collisions or destroyed ships), ensuring the persistence of the player's career even in case of mission failure.

---

## üåå Galactic Encyclopedia: Entities and Phenomena

The Star Trek Ultra universe is a dynamic ecosystem populated by 17 classes of entities, each with unique physical, tactical, and visual properties.

### üåü Celestial Bodies and Astronomical Phenomena
*   **Stars**: Classified into 7 spectral types (O, B, A, F, G, K, M). They provide energy via *Solar Scooping* (`sco`) but can become unstable and trigger a **Supernova**.
    *   **Frequency**: Extremely rare cataclysmic events (approx. 1.8% chance per minute).
    *   **Alert**: A countdown appears in the HUD when a star is imminent to explode.
    *   **Impact**: Total destruction of all vessels in the quadrant.
    *   **Aftermath**: The star is replaced by a permanent **Black Hole**, forever changing the galactic map.
*   **Planets**: Celestial bodies rich in minerals. They can be scanned and mined (`min`) for Dilithium, Tritanium, and other vital resources.
*   **Black Holes**: Gravitational singularities with accretion disks. They are the primary source of Antimatter (`har`), but their pull can be fatal.
*   **Nebulas**: Large clouds of ionized gases (Mutara, Paulson classes, etc.). They provide tactical cover (natural cloaking) but drain shields and disrupt sensors.
*   **Pulsars**: Neutron stars emitting deadly radiation. Navigating too close damages systems and crew.
*   **Comets**: Fast-moving objects with volumetric tails. They can be analyzed to collect rare gases.
*   **Spatial Rifts**: Tears in the spacetime fabric. They act as natural teleporters that project the ship to a random point in the galaxy.

### üö© Factions and Intelligent Ships
*   **Federation (Player/Starbase)**: Includes your ship and Starbases, where you can dock (`doc`) for full repairs and resupply.
*   **Klingon Empire**: Aggressive warriors patrolling quadrants, often protected by defense platforms.
*   **Romulan Star Empire**: Masters of deception using cloaking devices to launch surprise attacks.
*   **Borg Collective**: The greatest threat. Their Cubes have massive firepower and superior regenerative capabilities.
*   **NPC Factions**: Cardassians, Dominion (Jem'Hadar), Tholians, Gorn, Ferengi, Species 8472, Breen, and Hirogen. Each with varying levels of hostility and power.

#### ‚öñÔ∏è Faction System and "Renegade" Protocol
Star Trek Ultra implements a dynamic reputation system that manages relationships between the player and the various galactic powers.

*   **Allied IFF Recognition**: Upon character creation, the captain chooses a faction. NPC ships and defense platforms of the same faction will recognize the vessel as an ally and **will not open fire on sight**.
*   **Friendly Fire and Betrayal**: If a player deliberately attacks a unit of their own faction (ship, base, or platform):
    *   **Renegade Status**: The captain is immediately marked as a **TRAITOR (Renegade)**.
    *   **Immediate Retaliation**: All units of their own faction in the sector will become hostile and begin heavy attack maneuvers.
    *   **Alert Message**: The onboard computer will receive a critical warning: `FRIENDLY FIRE DETECTED! You have been marked as a TRAITOR by the fleet!`.
*   **Duration and Amnesty**: The traitor status is severe but temporary. It lasts for **10 minutes (real time)**.
    *   During this period, any further attack against allies will reset the timer.
    *   When the timer expires, if no further hostilities have been committed, Sector Command will grant amnesty: `Amnesty granted. Your status has been restored to active duty.` and faction units will return to being neutral/allied.

### ‚ö†Ô∏è Tactical Hazards and Resources
*   **Asteroid Fields**: Rocky debris posing a physical risk. Collision damage increases with ship speed.
*   **Space Mines**: Hidden explosive devices placed by hostile factions. Detectable only via close-range scanning.
*   **Derelict Ships**: Hulls of destroyed vessels. Can be dismantled (`dis`) to recover components and resources.
*   **Communication Buoys**: Starfleet network nodes. Being nearby enhances long-range sensors (`lrs`), providing detailed data on adjacent quadrants.
*   **Defense Platforms (Turrets)**: Heavily armed automated sentinels protecting strategic areas of interest.

### üëæ Anomalies and Creatures
*   **Space Monsters**: Includes the **Crystalline Entity** and the **Space Amoeba**, unique creatures that actively hunt vessels to feed on their energy.
*   **Ion Storms**: Meteorological phenomena moving through the galaxy, capable of blinding sensors and diverting ships' courses.

---

## üïπÔ∏è Operational Command Manual

Below is the complete list of available commands, grouped by function.

### üöÄ Navigation
*   `nav <H> <M> <Dist> [Factor]`: **High-Precision Warp Navigation**. Set course, precise distance and optional velocity.
    *   `H`: Heading (0-359).
    *   `M`: Mark (-90 to +90).
    *   `Dist`: Distance in Quadrants (supports decimals, e.g. `1.73`).
    *   `Factor`: (Optional) Warp Factor from 1.0 to 9.9 (Default: 6.0).
*   `imp <H> <M> <S>`: **Impulse Drive**. Sub-light engines. `S` represents speed from 0.0 to 1.0 (Full Impulse).
    *   `S`: Speed (0.0 - 1.0).
    *   `imp 0 0 0`: All Stop.
*   `cal <QX> <QY> <QZ> [SX SY SZ]`: **Navigational Computer (High Precision)**. Generates a full report with Heading, Mark, and a **Velocity Comparison Table**. If sector coordinates (SX, SY, SZ) are provided, it calculates the pinpoint route to that specific location.
*   `ical <X> <Y> <Z>`: **Impulse Calculator (ETA)**. Calculates H, M, and ETA to reach precise coordinates (0.0-10.0) within the current quadrant, based on current engine power allocation.
    
    *   `jum <QX> <QY> <QZ>`: **Wormhole Jump (Einstein-Rosen Bridge)**.
     Generates a wormhole for an instant jump to the destination quadrant.
    *   **Requirements**: 5000 units of Energy and 1 Dilithium Crystal.
    *   **Procedure**: Requires a singularity stabilization sequence of about 3 seconds.
*   `apr [ID] [DIST]`: **Approach Autopilot**. Automatic approach to target ID up to DIST distance.
    *   If no ID is provided, it uses the currently **locked target**.
    *   If only one number is provided, it is treated as **distance** for the locked target (if < 100).
*   `cha`: **Chase Autopilot**. Actively chases the locked target, maintaining intercept trajectory.
*   `rad <MSG>`: **Subspace Radio**. Sends a global message. Use `@Faction` for team chat or `#ID` for private messages.
*   `doc`: **Docking**. Dock at a Starbase (requires close range).
*   `map`: **Stellar Cartography**. Activates global 10x10x10 3D visualization of the entire galaxy.
    *   **Color Legend**: Enemies (Red), Bases (Green), Planets (Cyan), Stars (Yellow), Black Holes (Purple), **Nebulas (Grey)**, **Pulsars (Pulsing Orange)**.
    *   **Dynamic Anomalies**: Quadrants affected by **Ion Storms** are enclosed in a white transparent wireframe shell.
    *   **Localization**: Current ship position is indicated by a **pulsing white cube**.

### üî¨ Sensors and Scanners
*   `scan <ID>`: **Deep Scan Analysis**. Performs a deep scan of the target or anomaly.
    *   **Vessels**: Reveals hull integrity, shield levels per quadrant, residual energy, crew count, and subsystem damage.
    *   **Anomalies**: Provides scientific data on Nebulas and Pulsars.

#### üì° Sensor Integrity and Data Accuracy
The effectiveness of your sensors depends directly on the health of the **Sensors system (ID 2)**:
*   **100% Health**: Accurate and reliable data.
*   **Health < 100%**: Introduction of telemetry "noise". Sector coordinates `[X,Y,Z]` shown in `srs` become imprecise (error increases exponentially as health drops).
*   **Health < 50%**: The `lrs` command starts displaying corrupted or incomplete data about surrounding quadrants.
*   **Health < 30%**: Risk of "Target Ghosting" or failing to detect real objects.
*   **Repair**: Use `rep 2` to restore nominal sensor precision.

*   `srs`: **Short Range Sensors**. Detailed scan of the current quadrant.
    *   **Neighborhood Scan**: If the ship is near sector boundaries (< 2.5 units), sensors automatically detect objects in adjacent quadrants, listing them in a dedicated section to prevent ambushes.
*   `lrs`: **Long Range Sensors**. 3x3x3 scan of surrounding quadrants displayed via **LCARS Tactical Console** (Zones: Top, Center, Down).
    *   **Navigation Solution**: Each quadrant includes `H / M / W` parameters calculated to reach it immediately.
    *   **Primary Legend**: `[ H P N B S ]` (Black Holes, Planets, NPCs, Bases, Stars).
    *   **Anomaly Symbols**: `~`:Nebula, `*`:Pulsar, `+`:Comet, `#`:Asteroid, `M`:Monster, `>`:Rift.
    *   **Localization**: Your current quadrant is highlighted with a blue background.
*   `aux probe <QX> <QY> <QZ>`: **Subspace Sensor Probe**. Launches an automated probe to a specific quadrant.
    *   **Galactic Entity**: Probes are global objects. They traverse intermediate quadrants in real-time and are **visible to all players** along their flight path.
    *   **Sensor Integration**: Probes appear in the **SRS (Short Range Sensors)** list for any ship in the same sector (ID range 19000+), revealing the **Owner's Name** and current status.
    *   **Functionality**: Displays **ETA** and mission status in the owner's HUD.
    *   **Data Retrieval**: Upon arrival, it reveals the quadrant's composition (`H P N B S`) in the owner's map and sends a live telemetry report.
    *   **Persistence**: Remains at the target location as a **Derelict** (Red rings) after the mission.
    *   **Command `aux report <1-3>`**: Requests a fresh sensor update from an active probe.
    *   **Command `aux recover <1-3>`**: Recovers a probe if the ship is in the same quadrant and within range (< 2.0 units), freeing the slot and restoring 500 energy units.
*   `sta`: **Status Report**. Complete report on ship state, mission, and **Crew** monitoring.
*   `dam`: **Damage Report**. Detailed system damage.
*   `who`: List of active captains in the galaxy.

### ‚öîÔ∏è Tactical Combat
*   `pha <E>`: **Fire Phasers**. Fires phasers at the locked target (`lock`) using energy E. 
*   `pha <ID> <E>`: Fires phasers at a specific target ID. Damage decreases with distance.
*   `cha`: **Chase**. Automatically chases and intercepts the locked target.
*   `rad <MSG>`: **Radio**. Sends a subspace message to other captains (@Faction for team chat).
*   `axs` / `grd`: **Visual Guides**. Toggles 3D axes or tactical grid overlay.
*   `enc <algo>`: **Encryption Toggle**. Enables or disables encryption in real-time. Supports **AES-256-GCM**, **ChaCha20**, **ARIA**, **Camellia**, **Blowfish**, **RC4**, **CAST5**, **IDEA**, **3DES**, and **PQC (ML-KEM)**. Essential for protecting communications and reading secure messages from other captains.
*   `tor`: **Fire Photon Torpedo**. Launches an auto-guided torpedo at the locked target.
*   `tor <H> <M>`: Launches a torpedo in manual ballistic mode (Heading/Mark).
*   `lock <ID>`: **Target Lock**. Locks targeting systems onto target ID (0 to unlock). Essential for automated phaser and torpedo guidance.


### üÜî Galactic Identifier Schema (Universal ID)
To interact with galactic objects using the `lock`, `scan`, `pha`, `tor`, `bor`, and `dis` commands, the system employs a unique ID system. Use the `srs` command to identify the IDs of objects in your sector.

| Category | ID Range | Example | Primary Usage |
| :--- | :--- | :--- | :--- |
| **Player** | 1 - 999 | `lock 1` | Your vessel or other players |
| **NPC (Enemy)** | 1,000 - 1,999 | `lock 1050` | Chasing (`cha`) and combat |
| **Starbases** | 2,000 - 2,999 | `lock 2005` | Docking (`doc`) and resupply |
| **Planets** | 3,000 - 3,999 | `lock 3012` | Planetary mining (`min`) |
| **Stars** | 4,000 - 6,999 | `lock 4500` | Solar scooping (`sco`) |
| **Black Holes** | 7,000 - 7,999 | `lock 7001` | Antimatter harvest (`har`) |
| **Nebulas** | 8,000 - 8,999 | `lock 8000` | Scientific analysis and cover |
| **Pulsars** | 9,000 - 9.999 | `lock 9000` | Radiation monitoring |
| **Comets** | 10,000 - 10,999| `lock 10001` | Chasing and rare gas collection |
| **Derelicts** | 11,000 - 11,999| `lock 11005` | Boarding (`bor`) and tech recovery |
| **Asteroids** | 12,000 - 13,999| `lock 12000` | Precision navigation |
| **Mines** | 14,000 - 14,999| `lock 14000` | Tactical alert and avoidance |
| **Comm Buoys** | 15,000 - 15,999| `lock 15000` | Data link and `lrs` boost |
| **Platforms** | 16,000 - 16,999| `lock 16000` | Destroying hostile sentinels |
| **Spatial Rifts** | 17,000 - 17,999| `lock 17000` | Use for random jumps |
| **Monsters** | 18,000 - 18,999| `lock 18000` | Extreme combat scenarios |
| **Probes** | 19,000 - 19,999| `scan 19000` | Automated data collection |

**Note**: Locking only works if the object is in your current quadrant. If the ID exists but is far away, the computer will indicate the target's `Q[x,y,z]` coordinates.

### üîÑ Recommended Tactical Workflow
To perform complex operations (mining, resupply, boarding), follow this optimized sequence:

1.  **Identification**: Use `srs` to find the object ID (e.g., Star ID `4226`).
2.  **Lock-on**: Execute `lock 4226`. You will see the ID confirmed on your 3D HUD.
3.  **Approach**: Use `apr 4226 1.5`. The autopilot will bring you to the ideal interaction distance.
4.  **Interaction**: Once you arrive, launch the specific command:
    *   `sco` for **Stars** (Energy recharge).
    *   `min` for **Planets** (Mineral mining).
    *   `har` for **Black Holes** (Antimatter harvest).
    *   `bor` for **Derelicts** (Tech recovery and repairs).
    *   `cha` for **Comets** (Chase and gas collection).
    *   `pha` / `tor` for **Enemies/Monsters/Platforms** (Combat).

### üìè Interaction Distances Table
Distances expressed in sector units (0.0 - 10.0). If your distance is greater than the limit, the computer will respond with "No [object] in range".

| Object / Entity | Command / Action | Minimum Distance | Effect / Interaction |
| :--- | :--- | :--- | :--- |
| **Star** | `sco` | **< 2.0** | Solar scooping (energy recharge) |
| **Planet** | `min` | **< 2.0** | Planetary mining |
| **Starbase** | `doc` | **< 2.0** | Full repair, energy and torpedo refill |
| **Black Hole** | `har` | **< 2.0** | Antimatter harvesting |
| **Derelict** | `dis` | **< 1.5** | Dismantling for resources |
| **Enemy Ship** | `bor` | **< 1.0** | Boarding party operation |
| **Enemy Ship** | `pha` (Fire) | **< 6.0** | Maximum NPC phaser range |
| **Photon Torpedo** | (Impact) | **< 0.5** | Collision distance for detonation |
| **Comm Buoy** | (Passive) | **< 1.2** | Signal boost or auto-messages |
| **Space Amoeba** | (Contact) | **< 1.5** | Critical energy drain start |
| **Crystalline E.** | (Resonance) | **< 4.0** | Range of the resonance beam |
| **Celestial Body** | (Collision) | **< 1.0** | Hull damage and emergency rescue trigger |

### üöÄ Autopilot (`apr`)
The `apr <ID> <DIST>` command allows you to automatically approach any object detected by sensors. For mobile entities, interception works across the entire galaxy.

| Object Category | ID Range | Interaction Commands | Min. Distance | Navigation Notes |
| :--- | :--- | :--- | :--- | :--- |
| **Captains (Players)** | 1 - 32 | `rad`, `pha`, `tor`, `bor` | **< 1.0** (`bor`) | Galactic Tracking |
| **NPC Ships (Aliens)** | 1000 - 1999 | `pha`, `tor`, `bor`, `scan` | **< 1.0** (`bor`) | Galactic Tracking |
| **Starbases** | 2000 - 2199 | `doc`, `scan` | **< 2.0** | Current quadrant only |
| **Planets** | 3000 - 3999 | `min`, `scan` | **< 2.0** | Current quadrant only |
| **Stars** | 4000 - 6999 | `sco`, `scan` | **< 2.0** | Current quadrant only |
| **Black Holes** | 7000 - 7199 | `har`, `scan` | **< 2.0** | Current quadrant only |
| **Nebulas** | 8000 - 8499 | `scan` | - | Current quadrant only |
| **Pulsars** | 9000 - 9199 | `scan` | - | Current quadrant only |
| **Comets** | 10000 - 10299 | `cha`, `scan` | **< 0.6** (Gas) | **Galactic Tracking** |
| **Derelicts** | 11000 - 11149 | `bor`, `dis`, `scan` | **< 1.5** | Current quadrant only |
| **Asteroids** | 12000 - 13999 | `min`, `scan` | **< 1.0** | Current quadrant only |
| **Mines** | 14000 - 14999 | `scan` | - | Current quadrant only |
| **Comm Buoys** | 15000 - 15099 | `scan` | **< 1.2** | Current quadrant only |
| **Defense Platforms** | 16000 - 16199 | `pha`, `tor`, `scan` | - | Current quadrant only |
| **Spatial Rifts** | 17000 - 17049 | `scan` | - | Current quadrant only |
| **Space Monsters** | 18000 - 18029 | `pha`, `tor`, `scan` | **< 1.5** | **Galactic Tracking** |

*   `she <F> <R> <T> <B> <L> <RI>`: **Shield Configuration**. Distributes energy to the 6 shields.
*   `clo`: **Cloaking Device**. Activates/Deactivates cloak. Consumes 15 energy units/tick. Provides invisibility to NPCs and other factions; unstable in nebulas.
*   `pow <E> <S> <W>`: **Power Allocation**. Allocates reactor energy (Engines, Shields, Weapons %).
*   `aux jettison`: **Eject Warp Core**. Ejects the core (Suicide maneuver / Last resort).
*   `xxx`: **Self-Destruct**. Sequential self-destruction.

### ‚ö° Reactor and Power Management

The `pow` command is critical for survival and tactical superiority. It dictates how the ship's main reactor output is partitioned across three core subsystems:

*   **Engines (E)**: Affects **Impulse Drive** responsiveness and top speed. High allocation allows for rapid maneuvers and faster sector traversal.
*   **Shields (S)**: Governs the **Regeneration Rate** of all 6 shield quadrants. If shields are damaged, they draw energy from the reactor to rebuild their integrity.
    *   **Dynamic Scaling**: The regeneration speed is a product of both the assigned **Power (S)** and the **Shield System Integrity**. If the shield generator is damaged, regeneration will be severely hampered regardless of power allocation.

#### üõ°Ô∏è Shield Mechanics and Hull Integrity
The ship is protected by 6 independent quadrants: **Front (F), Rear (R), Top (T), Bottom (B), Left (L), and Right (RI)**.

*   **Localized Damage**: Attacks (Phasers/Torpedoes) now hit specific quadrants based on the relative angle of impact.
*   **Hull Integrity**: Represents the physical health of the ship (0-100%). If a shield quadrant reaches 0% or the impact is excessively powerful, residual damage directly hits the structural integrity.
*   **Internal System Damage**: When the hull is struck directly (shields at zero), there is a high probability of sustaining damage to subsystems (engines, weapons, sensors, etc.).
    *   **Phasers**: Moderate chance of random system damage.
    *   **Torpedoes**: Very high chance (>50%) of critical system failure upon impact.
*   **Hull Plating (Duranium)**: Additional plating (command `hull`) acts as a buffer: it absorbs physical damage *before* it affects Hull Integrity.
*   **Destruction Condition**: If **Hull Integrity reaches 0%**, the ship instantly explodes, regardless of remaining energy or shield levels.
*   **Continuous Regeneration**: Unlike older systems, shield regeneration is continuous but scales with hardware health.
*   **Shield Failure**: If a quadrant reaches 0% integrity, subsequent hits from that direction will deal direct damage to the hull and the main energy reactor.

#### üõ∏ Cloaking Device
The `clo` command activates an advanced cloaking technology that manipulates light and sensors to make the vessel invisible.

*   **Tactical Invisibility**: Once active, you will not be detectable by the sensors (`srs`/`lrs`) of other players (unless they belong to your own faction). NPC ships will ignore you completely and will not initiate attack maneuvers.
*   **Energy Costs**: Maintaining the cloak field is extremely energy-intensive, consuming **15 energy units per logic tick**. Carefully monitor your reactor reserves.
*   **Sensor Limitations**: While cloaked, onboard sensors experience interference ("Sensors limited"), making it harder to acquire precise environmental data.
*   **Instability in Nebulas**: Inside nebulas, the cloak field becomes unstable due to ionized gases. This can cause fluctuations in energy drain and inhibit shield regeneration.
*   **Visual Feedback**: When cloaked, the original ship model disappears and is replaced by a wireframe mesh with a pulsing **"Blue Glowing" effect**. The HUD will display the status `[ CLOAKED ]` in magenta.
*   **Combat Restrictions**: You cannot fire **Phasers** (`pha`) or launch **Torpedoes** (`tor`) while the cloaking device is active. You must decloak to engage the enemy.
*   **NPC Strategy (Romulans)**: The Romulan Star Empire uses advanced cloaking tactics; their ships will remain cloaked while patrolling or fleeing, only revealing themselves to launch an attack.

*   **Weapons (W)**: Directly scales the **Phaser Beam Intensity** and **Recharge Rate**. A higher allocation results in more energy being focused into the phaser banks, dealing exponentially more damage and allowing the phaser capacitor to refill much faster.

#### üéØ Tactical Ordnance Note: Phasers and Torpedoes
*   **Phaser Capacitor**: Visible in the HUD as "PHASER CAPACITOR: XX%". This represents the energy currently stored in the weapon banks.
    *   **Firing**: Each phaser burst consumes a portion of the capacitor based on the energy setting. If the capacitor is below 10%, you cannot fire.
    *   **Recharging**: Refills automatically every second. The refill speed is directly boosted by assigning more power to **Weapons (W)** via the `pow` command.
*   **Phaser Integrity**: In the HUD as "PHASER INTEGRITY: XX%". This represents hardware health. Damage is multiplied by this value. Use `rep 4` to fix.
*   **Torpedo Tubes**: Visible in the HUD as "TUBES: <STATE>".
    *   **READY**: Systems are armed and ready to fire.
    *   **FIRING...**: A torpedo is currently in flight. New launches are inhibited until impact or sector exit.
    *   **LOADING...**: Post-launch cooling and reloading sequence (approx. 5 seconds).
    *   **OFFLINE**: Hardware integrity is below 50%. Launching is impossible until the system is repaired (`rep 5`).

### üíì Life Support and Crew Safety
The HUD displays "LIFE SUPPORT: XX.X%", which is directly linked to the integrity of the ship's vital systems.
*   **Initialization**: Every mission starts with Life Support at 100%.
*   **Critical Threshold**: If the percentage drops below **75%**, the crew will begin to suffer casualties due to environmental failure (radiation, oxygen loss, or gravity fluctuations).
*   **Emergency Repairs**: Maintaining Life Support above the threshold is the highest priority. Use `rep 7` immediately if integrity is compromised.
*   **Mission Failure**: If the crew count reaches **zero**, the vessel is declared lost, and the simulation ends.

**HUD Feedback**: The current allocation is visible in the bottom-right diagnostics panel as `POWER: E:XX% S:XX% W:XX%`. Monitoring this is essential to ensure your ship is optimized for the current mission phase (Exploration vs. Combat).

### üì¶ Operations and Resources
*   `bor [ID]`: **Boarding Party**. Sends boarding parties (Dist < 1.0).
    *   Works on the currently **locked target** if no ID is specified.
    *   **NPC/Derelict Interaction**: Automatic rewards (Dilithium, Chips, Repairs, Survivors, or Prisoners).
    *   **Player-to-Player Interaction**: Opens an **Interactive Tactical Menu** with specific choices:
        *   **Allied Vessels**: `1`: Transfer Energy, `2`: Repair System, `3`: Send Crew Reinforcements.
        *   **Hostile Vessels**: `1`: Sabotage System, `2`: Raid Cargo Hold, `3`: Capture Hostages.
    *   **Selection**: Reply with the number `1`, `2`, or `3` to execute the action.
    *   **Risks**: Resistance chance (30% for players, higher for NPCs) may cause team casualties.
*   `dis`: **Dismantle**. Dismantles enemy wrecks for resources (Dist < 1.5).
*   `min`: **Mining**. Extracts resources from an orbiting planet (Dist < 3.1).
*   `sco`: **Solar Scooping**. Collects energy from a star (Dist < 3.1).
*   `har`: **Harvest Antimatter**. Collects antimatter from a black hole (Dist < 3.1).
*   `con T A`: **Convert Resources**. Converts raw materials into energy or torpedoes (`T`: resource type, `A`: amount).
    *   `1`: Dilithium -> Energy (x10).
    *   `2`: Tritanium -> Energy (x2).
    *   `3`: Verterium -> Torpedoes (1 per 20).
    *   `6`: Gas -> Energy (x5).
    *   `7`: Duranium -> Energy (x4).
    *   `8`: Keronium -> Energy (x25). [High efficiency]
*   `load <T> <A>`: **Load Systems**. Transfers energy or torpedoes from cargo to active systems.
    *   `1`: Energy (Main Reactor). Max capacity: 9,999,999 units. Allows converting harvested Antimatter from Black Holes into operational energy.
    *   `2`: Torpedoes (Launch Tubes). Max capacity: 1000 units.

#### üèóÔ∏è Hull Reinforcement (Hull Plating)
*   `hull`: **Reinforce Hull**. Uses **100 units of Duranium** to apply reinforced plating to the hull (+500 integrity units).
    *   Duranium plating acts as a secondary physical shield, absorbing residual damage that bypasses energy shields before it hits the main reactor.
    *   Plating status is visible in the 3D HUD and via the `sta` command.
*   `inv`: **Inventory**. Shows cargo bay content, including raw materials (**Monotanium**, **Isolinear**, **Duranium**) and **Prisoners**.

### üì¶ Cargo and Resource Management

Star Trek Ultra distinguishes between **Active Systems**, **Cargo Storage**, and the **Prison Unit**. This is reflected in the HUD as `ENERGY: X (CARGO: Y)`.



*   **Active Energy/Torps**: These are resources currently available for immediate use.

*   **Cargo Reserves (Cargo Bay)**: Resources stored for long-range replenishment.

    *   **Resource Table**:

        1. **Dilithium**: Warp Jump and energy conversion.

        2. **Tritanium**: Hull repairs and energy conversion.

        3. **Verterium**: Material for photon torpedo warheads (`[WARHEADS]`).

        4. **Monotanium**: Advanced structural alloy.

        5. **Isolinear**: Chips for complex system repairs.

                6. **Gases**: Collected from comets, energy conversion.

                7. **Duranium**: Armored hull plating.

                8. **Keronium**: Rare radioactive mineral found in specialized asteroids and planets. Used for experimental tech and system enhancement.

*   **Prison Unit**: A dedicated unit for detaining enemy personnel captured during boarding operations. It is monitored in real-time in the vital HUD next to the crew count.

*   **Resource Conversion**: Raw materials must be converted (`con`) into **CARGO Antimatter** or **CARGO Torpedoes** before loading into active systems.

*   `rep [ID]`: **Repair**. Repairs a damaged system (health < 100%) restoring it to full efficiency. Essential for fixing sensor noise or reactivating offline weapons.
    *   **Cost**: Each repair consumes **50 Tritanium** and **10 Isolinear Chips**.
    *   **Usage**: If no ID is provided, lists all 10 ship systems with their current integrity status.
    *   **System IDs**: `0`: Warp, `1`: Impulse, `2`: Sensors, `3`: Transp, `4`: Phasers, `5`: Torps, `6`: Computer, `7`: Life Support, `8`: Shields, `9`: Aux.
*   **Crew Management**: 
    *   Initial personnel number depends on ship class (e.g., 1012 for Galaxy, 50 for Defiant).    *   **Vital Integrity**: If **Life Support** drops below 75%, the crew will start suffering periodic losses.
    *   **Shield Integrity**: If the **Shield System (ID 8)** integrity is low, the automatic recharge of the 6 quadrants is slowed down.
    *   **Failure Condition**: If crew reaches **zero**, the mission ends and the ship is considered lost.

### 3. Operational Command Guide & Subspace Cryptography

The Star Trek Ultra bridge operates via a high-precision Command Line Interface (CLI). Beyond navigation and combat, the simulator implements a sophisticated **Electronic Warfare** system based on real-world cryptography.

#### üõ∞Ô∏è Advanced Navigation & Utility Commands
*   `nav <H> <M> <W> [F]`: **Warp Navigation**. Plots a warp course towards relative coordinates. `H`: Heading (0-359), `M`: Mark (-90/+90), `W`: Distance in quadrants, `F`: Optional Warp Factor (1.0 - 9.9).
*   `imp <H> <M> <S>`: **Impulse Drive**. Sub-light navigation within the current sector. `S`: Speed in percentage (1-100%). Use `imp <S>` to only adjust speed.
*   `jum <Q1> <Q2> <Q3>`: **Wormhole Jump**. Generates a spatial tunnel to a distant quadrant. Requires **5000 Energy and 1 Dilithium Crystal**.
*   `apr <ID> [DIST]`: **Automatic Approach**. Autopilot intercepts the specified object at the desired distance (default 2.0). Works galaxy-wide for ships and comets.
*   `cha`: **Chase Target**. Actively pursues the currently locked (`lock`) target.
*   `rep <ID>`: **Repair System**. Initiates repairs on a subsystem (1: Warp, 2: Impulse, 3: Sensors, 4: Phasers, 5: Torpedoes, etc.).
*   `inv`: **Inventory Report**. Detailed list of resources in cargo (Dilithium, Tritanium, Gases, etc.).
*   `dam`: **Damage Report**. Detailed status of hull integrity and systems.
*   `cal <Q1> <Q2> <Q3>`: **Warp Calculator**. Calculates the vector towards the center of a distant quadrant.
*   `cal <Q1> <Q2> <Q3> <X> <Y> <Z>`: **Pinpoint Calculator**. Calculates the vector towards precise sector coordinates `[X, Y, Z]` in a distant quadrant. Provides arrival times and suggests the exact `nav` command to copy.
*   `ical <X> <Y> <Z>`: **Impulse Calculator (ETA)**. Provides a full navigational computation for precise sector coordinates [0.0 - 10.0], including real-time travel time at current power levels.
*   `who`: **Captains Registry**. Lists all commanders currently active in the galaxy, their tracking IDs, and current position. Crucial for identifying allies or potential predators before entering a sector.
*   `sta`: **Status Report**. Complete systems diagnostic, including energy levels, hardware integrity, and power distribution.
*   `hull`: **Duranium Reinforcement**. If you have **100 units of Duranium** in cargo, this command applies reinforced plating to the hull (+500 HP physical shield), visible as gold in the HUD.

#### üõ°Ô∏è Tactical Cryptography: Communication "Frequencies"
In Star Trek Ultra, encryption is not just about security‚Äîit's a **tactical frequency choice**. Each algorithm acts as a separate communication band.

*   **Identity & Signature (Ed25519)**: Every radio packet is digitally signed. If you receive a message with a **`[VERIFIED]`** tag, you have mathematical certainty it comes from the declared captain and has not been altered by enemy sensors or spatial phenomena.
*   **Cryptographic Frequencies (`enc <TYPE>`)**:
    *   **AES (`enc aes`)**: The balanced Starfleet standard. Secure and optimized for modern hardware.
    *   **PQC (`enc pqc`)**: **Post-Quantum Cryptography (ML-KEM)**. Represents the ultimate defense against Quantum Computers from the Borg or temporally advanced civilizations. The most secure protocol available.
    *   **ChaCha (`enc chacha`)**: Ultra-fast, ideal for quick communications in unstable subspace conditions.
    *   **Camellia (`enc camellia`)**: Standard protocol of the Romulan Empire, known for its elegant structure and resistance to brute-force attacks.
    *   **ARIA (`enc aria`)**: Standard used by the Klingon Alliance for coalition operations.
    *   **IDEA / CAST5**: Protocols often used by resistance groups (Maquis) or mercenaries to avoid standard Starfleet monitoring.
    *   **OFF (`enc off`)**: Clear communication. Risky, but useful for universal distress calls readable by anyone.

**Tactical Implication**: If an allied fleet decides to operate on "ARIA Frequency", every member must set `enc aria`. Those staying on AES will see only static noise (**`<< SIGNAL DISTURBED >>`**), allowing secure and secret communications even in crowded sectors.

### üì° Communications and Miscellaneous
*   `rad <MSG>`: Sends radio message to all (Open channel).
    *   **Faction Table (@Fac)**:
        | Faction | Full Name | Abbreviated |
        | :--- | :--- | :--- |
        | **Federazione** | `@Federation` | `@Fed` |
        | **Klingon** | `@Klingon` | `@Kli` |
        | **Romulani** | `@Romulan` | `@Rom` |
        | **Borg** | `@Borg` | `@Bor` |
        | **Cardassiani** | `@Cardassian` | `@Car` |
        | **Dominio** | `@JemHadar` | `@Jem` |
        | **Tholiani** | `@Tholian` | `@Tho` |
        | **Ferengi** | `@Ferengi` | `@Fer` |
        | **Specie 8472** | `@Species8472`| `@8472` |
        | **Gorn / Breen / Hirogen** | Full Name | - |
*   `rad #ID <MSG>`: Private message to player ID.
*   `psy`: **Psychological Warfare**. Attempts a bluff (Corbomite Maneuver).
*   `axs` / `grd`: Toggles 3D visual guides (Axes / Grid).
*   `h` (hotkey): Hides the HUD for a "cinematic" view.
        | **Federation** | `@Federation` | `@Fed` |
        | **Klingon** | `@Klingon` | `@Kli` |
        | **Romulan** | `@Romulan` | `@Rom` |
        | **Borg** | `@Borg` | `@Bor` |
        | **Cardassian** | `@Cardassian` | `@Car` |
        | **Dominion** | `@JemHadar` | `@Jem` |
        | **Tholian** | `@Tholian` | `@Tho` |
        | **Ferengi** | `@Ferengi` | `@Fer` |
        | **Species 8472** | `@Species8472`| `@8472` |
        | **Gorn / Breen / Hirogen** | Full Name | - |
*   `rad #ID <MSG>`: Private message to player ID.
*   `psy`: **Psychological Warfare**. Attempts bluff (Corbomite Maneuver).
*   `axs` / `grd`: Activates/Deactivates 3D visual guides (Axes / Grid).
The 3D viewer is not a simple graphic window but an extension of the command bridge providing overlaid telemetry data (Augmented Reality) to support the captain's decision-making process.

#### üéØ Integrated Tactical Projection
The system uses spatial projection algorithms to anchor information directly above detected entities:
*   **Targeting Tags**: Each vessel is identified with an advanced dynamic label.
    *   **Federation Players**: Displays `Federation - [Class] ([Captain Name])`.
    *   **Alien Players**: Displays `[Faction] ([Captain Name])`.
    *   **NPC Units**: Displays `[Faction] [ID]`.
*   **Health Bars**: Chromatic health indicators (Green/Yellow/Red) displayed above each ship and station, allowing instant evaluation of enemy status without consulting text logs.
*   **Visual Latching**: Combat effects (phasers, explosions) are temporally synchronized with server logic, providing immediate visual feedback on hit impact.

#### üß≠ 3D Tactical Compass (`axs`)
By activating visual axes (`axs`), the simulator projects a spherical reference system centered on your ship.

**Axis Convention Note**: The graphics engine uses the **OpenGL (Y-Up)** standard.
*   **X (Red)**: Transverse axis (Left/Right).
*   **Y (Green)**: Vertical axis (Up/Down). This is the rotation axis for *Heading*.
*   **Z (Blue)**: Longitudinal axis (Depth/Forward motion).
*   **Boundary Coordinates**: At the center of each face of the tactical cube, the coordinates `[X,Y,Z]` of adjacent quadrants are projected.

---

### üñ•Ô∏è Server Architecture and LCARS Telemetry

Upon launching `trek_server`, the system performs a complete diagnostic of the host infrastructure, displaying an **LCARS (Library Computer Access and Retrieval System)** telemetry panel.

#### üìä Monitored Data
*   **Logical Infrastructure**: Host identification, Linux kernel version, and core libraries (**GNU libc**).
*   **Memory Allocation**: 
    *   **Physical RAM**: Status of available physical memory.
    *   **Shared Segments (SHM)**: Monitoring of active shared memory segments, vital for the *Direct Bridge* IPC.
*   **Network Topology**: List of active interfaces, IP addresses, and real-time traffic statistics (**RX/TX**) retrieved from the kernel.
*   **Subspace Dynamics**: System load average and number of active logical tasks.

This diagnostic ensures the server operates in a nominal environment before opening subspace communication channels on port `3073`.


#### üìü HUD Telemetry and Monitoring
The on-screen interface (Overlay) provides constant monitoring of vital parameters:
*   **Reactor & Shield Status**: Real-time display of available energy and average defensive grid power.
*   **Cargo Monitoring**: Explicit monitoring of **CARGO ANTIMATTER** and **CARGO TORPEDOES** reserves for rapid resupply.
*   **Hull Integrity**: Physical state of the hull (0-100%). If it drops to zero, the vessel is lost.
*   **Hull Plating**: Golden indicator of Duranium-reinforced hull integrity (visible only if present).
*   **Sector Coordinates**: Instant conversion of spatial data into relative coordinates `[S1, S2, S3]` (0.0 - 10.0), mirroring those used in `nav` and `imp` commands.
*   **Threat Detector**: A dynamic counter indicates the number of hostile vessels detected by sensors in the current quadrant.
*   **Subspace Uplink Diagnostics Suite**: An advanced diagnostic panel (bottom right) monitoring the health of the neural/data link. It shows real-time Link Uptime, **Pulse Jitter**, **Signal Integrity**, protocol efficiency, and the active status of **AES-256-GCM** encryption.

#### üõ†Ô∏è View Customization
The commander can configure their interface via quick CLI commands:
*   `grd`: Activates/Deactivates the **Galactic Tactical Grid**, useful for perceiving depth and distances.
*   `axs`: Activates/Deactivates the **AR Tactical Compass**. This holographic compass is anchored to the ship's position: the Azimuth ring (Heading) remains oriented towards Galactic North (fixed coordinates), while the Elevation arc (Mark) rotates with the vessel, providing an immediate navigation reference for combat maneuvers.
*   `h` (hotkey): Completely hides the HUD for a "cinematic" view of the sector.
*   **Zoom & Rotation**: Total control of the tactical camera via mouse or `W/S` keys and directional arrows.

---

## ‚ö†Ô∏è Tactical Report: Threats and Obstacles

### NPC Ship Capabilities
Computer-controlled ships (Klingons, Romulans, Borg, etc.) operate with standardized combat protocols:
*   **Primary Armament**: Currently, NPC ships are equipped exclusively with **Phaser Banks**.
*   **Firepower**: Enemy phasers inflict constant damage of **10 units** of energy per hit (reduced for balance).
*   **Engagement Range**: Hostile ships will automatically open fire if a player enters within a **6.0 unit** range (Sector).
*   **Fire Rate**: Approximately one shot every 5 seconds.
*   **Tactics**: NPC ships do not use photon torpedoes. Their main strategy consists of direct approach (Chase) or fleeing if energy drops below critical levels.

### ‚òÑÔ∏è Photon Torpedo Dynamics
Torpedoes (`tor` command) are physically simulated weapons with high precision:
*   **Collision**: Torpedoes must physically hit the target (distance **< 0.8**) to explode (increased radius to prevent tunneling).
*   **Guidance**: If launched with an active `lock`, torpedoes correct their course by **35%** per tick towards the target, allowing hits on agile ships.
*   **Comet Chasing**: You can use the `cha` (Chase) command to follow comets along their galactic orbit, making gas collection easier.
*   **Obstacles**: Celestial bodies like **Stars, Planets, and Black Holes** are solid physical objects. A torpedo impacting them will be absorbed/destroyed without hitting the target behind them. Use galactic terrain for cover!
*   **Starbases**: Starbases also block torpedoes. Beware of friendly or incidental fire.

### üå™Ô∏è Space Anomalies and Environmental Hazards
The quadrant is scattered with natural phenomena detectable by both sensors and the **3D tactical view**:
*   **Nebulas (Mutara Class - ID 4xxx)**:
    *   **Effect**: Clouds of ionized gases interfering with deflector shields.
    *   **3D View**: Rendered as semi-transparent grey gas volumes.
    *   **Hazard**: Remaining inside (Distance < 2.0) causes constant energy drain.
*   **Pulsars (ID 5xxx)**:
    *   **Effect**: Rapidly rotating neutron stars emitting deadly radiation.
    *   **3D View**: Visible as bright cores with rotating radiation beams.
    *   **Hazard**: Approaching too close (Distance < 2.5) severely damages shields and rapidly kills crew via radiation poisoning.
*   **Comets (ID 6xxx)**:
    *   **Effect**: Fast-moving objects traversing the sector.
    *   **3D View**: Icy nuclei with a blue trail of gas and dust.
    *   **Resource**: Approaching the tail (< 0.6) allows the collection of rare gases.
*   **Asteroid Fields (ID 8xxx)**:
    *   **Effect**: Clusters of space rocks of various sizes.
    *   **3D View**: Rotating brown rocks with irregular shapes.
    *   **Hazard**: Navigating inside at high impulse speed (> 0.1) causes continuous damage to shields and engines.
*   **Derelict Ships (ID 7xxx)**:
    *   **Effect**: Abandoned Starfleet or alien vessels.
    *   **3D View**: Dark and cold hulls drifting slowly in space.
    *   **Opportunity**: Can be explored via the `bor` (boarding) command to recover Dilithium, Isolinear Chips, or to perform instant emergency repairs.
*   **Minefields (ID 9xxx)**:
    *   **Effect**: Defensive zones with cloaked mines placed by hostile factions.
    *   **3D View**: Small spiked metallic spheres with pulsing red light (visible only at distance < 1.5).
    *   **Hazard**: Detonation causes massive damage to shields and energy. Use the `scan` command to detect them before entering the sector.
*   **Communication Buoys (ID 10xxx)**:
    *   **Effect**: Starfleet network nodes for sector monitoring.
    *   **3D View**: Lattice structures with rotating antennas and pulsing blue signals.
    *   **Advantage**: Being near a buoy (< 1.2) enhances long-range sensors (`lrs`), revealing the exact composition of adjacent quadrants instead of a simple count.
*   **Defense Platforms (ID 11xxx)**:
    *   **Effect**: Heavily armed static sentinels protecting strategic zones.
    *   **3D View**: Hexagonal metallic structures with active phaser banks and an energy core.
    *   **Hazard**: Extremely dangerous if approached without full shields. Automatically fire at non-cloaked targets within a 5.0 unit range.
*   **Spatial Rifts (ID 12xxx)**:
    *   **Effect**: Unstable natural teleporters caused by tears in the spacetime fabric that ignore normal Warp navigation laws.
    *   **3D View**: Rendered as rotating cyan energy rings. On the galactic map and sensors (`srs` or `lrs`), they are marked with **Cyan** color or the letter **R**.
    *   **Risk/Opportunity**: Entering a rift (Distance < 0.5) instantly projects the ship to a completely random point in the universe (random quadrant and sector). It can be a fatal hazard (e.g., Borg territory) or the only quick escape route during a critical attack.
*   **Space Monsters (ID 13xxx)**:
    *   **Crystalline Entity**: Geometric predator that chases ships and fires crystalline resonance beams.
    *   **Space Amoeba**: Giant lifeform that drains energy on contact.
    *   **Hazard**: Extremely rare and dangerous. Require group tactics or maximum firepower.
*   **Ion Storms**:
    *   **Effect**: Random global events synchronized in real-time on the map.
    *   **Frequency**: High (statistical average of one event every 5-6 minutes).
    *   **Technical Impact**: Hitting a storm **instantly halves** sensor health (ID 2).
    *   **Functional Degradation**: Damaged sensors (< 100%) produce "noise" in SRS/LRS reports (ghost objects, missing data, or imprecise coordinates). Below 25%, sensors become nearly unusable.
    *   **Technical Details**: Checked every 1000 ticks (33s), 20% event probability, with a 50% specific weight for ion storms.
    *   **Hazard**: Can blind sensors or violently push the ship off course.

## üì° Game Dynamics and Events
The universe of Star Trek Ultra is brought to life by a series of dynamic events that require quick thinking from the command bridge.

#### ‚ö° Random Sector Events
*   **Subspace Surges**: Sudden fluctuations that can partially recharge energy reserves or cause an overload resulting in energy loss.
*   **Spatial Shear**: Violent gravitational currents that hit the ship during navigation, physically pushing it off course.
*   **Life Support Emergency**: If the `Life Support` system is damaged, the crew will start suffering casualties. This is a critical condition requiring urgent repairs or docking at a starbase.

#### üö® Tactical and Emergency Protocols
*   **Corbomite Bluff**: The `psy` command allows you to transmit a fake nuclear threat signal. If successful, enemy vessels will immediately enter retreat mode.
*   **Emergency Rescue Protocol**: In case of vessel destruction or fatal collision, upon re-entry Starfleet Command will initiate an automatic rescue mission, repositioning the ship in a safe sector and restoring core systems to 80% integrity.
*   **Boarding Resistance**: Boarding operations (`bor`) are not without risks; teams can be repelled, causing internal damage to your ship's isolinear circuits.

---

## üéñÔ∏è Commanders Historical Registry

This section provides an official reference to the most celebrated commanders of the galaxy, useful for player inspiration or designating elite vessels.

### üî¥ Galactic Power Commanders

#### 1. Klingon Empire
*   **Kor**: The legendary "Dahar Master", pioneer of early tactical contacts with the Federation.
*   **Martok**: Supreme Commander of Klingon forces during the Dominion War.
*   **Gowron**: Chancellor and veteran of the Klingon Civil War.

#### 2. Romulan Star Empire
*   **Tomalak**: Commander of D'deridex class vessels and historic tactical adversary.
*   **Sela**: Operational commander and strategist specializing in infiltration operations.
*   **Donatra**: Commander of the *Valdore*, known for tactical cooperation during the Shinzon crisis.

#### 3. Borg Collective
*   **Locutus**: Tactical designation of Captain Picard during the Wolf 359 incursion.
*   **The Queen**: Central coordination node of the Collective.
*   **Unimatrix 01**: Command designation for Diamond class vessels or Tactical Cubes.

#### 4. Cardassian Union
*   **Gul Dukat**: Leader of occupation forces and commander of station Terok Nor.
*   **Gul Madred**: Expert in interrogation and intelligence operations.
*   **Gul Damar**: Leader of the Cardassian resistance and successor to supreme command.

#### 5. Dominion (Jem'Hadar)
*   **Remata'Klan**: First of the Jem'Hadar, symbol of discipline and absolute loyalty.
*   **Ikat'ika**: Commander of ground forces and master of tactical combat.
*   **Karat'Ulan**: Operational commander in the Gamma Quadrant.

#### 6. Tholian Assembly
*   **Loskene**: Commander known for employing the Tholian energy web.
*   **Terev**: Ambassador and commander involved in territorial disputes.
*   **Sthross**: Flotilla commander expert in energy confinement tactics.

#### 7. Gorn Hegemony
*   **Slar**: Warrior commander active during early expansion phases.
*   **S'Sless**: Captain in charge of frontier outpost defense.
*   **Varn**: Fleet commander during skirmishes in the Alpha Quadrant.

#### 8. Ferengi Alliance
*   **DaiMon Bok**: Known for employing simulation technologies and personal vendettas.
*   **DaiMon Tog**: Commander specializing in forced technology acquisitions.
*   **DaiMon Goss**: Tactical representative during negotiations for Wormhole control.

#### 9. Species 8472
*   **Boothby (Impersonator)**: Entity dedicated to infiltration and study of Fleet command.
*   **Bio-Ship Alpha**: Designation of the tactical coordinator of organic vessels.
*   **Valerie Archer (Impersonator)**: Infiltration subject for deep reconnaissance missions.

#### 10. Breen Confederacy
*   **Thot Pran**: High-ranking commander during the offensive in the Alpha Quadrant.
*   **Thot Gor**: Operational leader during the strategic alliance with the Dominion.
*   **Thot Tarek**: Commander of Breen strike forces.

#### 11. Hirogen
*   **Karr**: Alpha Hirogen expert in large-scale hunt simulations.
*   **Idrin**: Veteran hunter and commander of prey vessels.
*   **Turanj**: Commander specializing in long-range tracking.

---

---

### üîµ Starfleet Commanders by Ship Class

In Star Trek Ultra, the choice of ship class is not just aesthetic but defines the Commander's operational profile. Below are historical and tactical references for available classes:

#### üèõÔ∏è Constitution Class (Heavy Cruiser)
The symbol of Starfleet exploration in the 23rd century. Balanced, versatile, and robust vessel.
*   **Famous Commanders**:
    *   **James T. Kirk**: Legendary captain of the *USS Enterprise* (NCC-1701), known for his unconventional tactical solutions.
    *   **Christopher Pike**: Kirk's predecessor, symbol of integrity and courage.
    *   **Robert April**: The first commander to take the Constitution class into the depths of unexplored space.

#### üõ∞Ô∏è Miranda Class (Multi-role Vessel)
Reliable and long-lived, the Miranda class is the backbone of tactical and scientific support.
*   **Famous Commanders**:
    *   **Clark Terrell**: Commander of the *USS Reliant*, tragically involved in the Genesis Project crisis.
    *   **Walker Keel**: Close friend of Picard and key figure in discovering the parasitic infiltration in Fleet Command.

#### ‚öîÔ∏è Defiant Class (Heavy Escort)
Designed specifically for combat against the Borg. Small, extremely maneuverable, and heavily armed.
*   **Famous Commanders**:
    *   **Benjamin Sisko**: The "Emissary of the Prophets", who led the *USS Defiant* during the most critical phases of the Dominion War.
    *   **Worf**: Klingon tactical master who often commanded the Defiant in frontline scenarios.

#### üëë Galaxy Class (Long Range Explorer)
A "city in space". Designed for decade-long missions and high-level diplomacy, equipped with massive firepower.
*   **Famous Commanders**:
    *   **Jean-Luc Picard**: Commander of the *USS Enterprise-D*, unparalleled diplomat and fine strategist.
    *   **Edward Jellico**: Known for his rigid military protocol during the Cardassian crisis.

#### ‚ö° Sovereign Class (Battle Cruiser)
The pinnacle of Starfleet war technology in the late 24th century. Designed to face the most extreme threats.
*   **Famous Commanders**:
    *   **Jean-Luc Picard**: Commanding the *USS Enterprise-E* during the Battle of Sector 001 and the Ba'ku insurrection.
    *   **William T. Riker**: Led the Sovereign in Picard's absence, demonstrating superior tactical audacity.

#### üî≠ Intrepid Class (Scientific Explorer)
Fast and equipped with neural bio-circuits. Designed for research and autonomy in remote quadrants.
*   **Famous Commanders**:
    *   **Kathryn Janeway**: The legendary captain who guided the *USS Voyager* for 70,000 light-years through the Delta Quadrant.
    *   **Rudy Ransom**: Commander of the *USS Equinox*, whose story represents the dark side of survival in deep space.

#### üõ°Ô∏è Other Operational Classes
*   **Excelsior**: Led by **Hikaru Sulu**, pioneer of deep space exploration.
*   **Constellation**: The class of the *USS Stargazer*, Picard's first command.
*   **Akira / Steamrunner**: Flagships for territory defense during large-scale invasions.
*   **Ambassador**: A technological bridge between the Excelsior and Galaxy classes, led by **Rachel Garrett**.
*   **Oberth**: Light scientific vessel, essential for advanced stellar scans.

---

## üíæ Persistence and Continuity
Star Trek Ultra's architecture is designed to support a persistent and dynamic galaxy. Every action, from discovering a new planetary system to loading the Cargo Bay, is preserved via a low-level binary archiving system.

#### üóÑÔ∏è The Galactic Database (`galaxy.dat`)
The `galaxy.dat` file constitutes the simulator's historical memory. It uses a **Direct Serialization** structure of the server RAM:
*   **Galaxy Master Matrix**: A 10x10x10 three-dimensional grid storing mass density and composition of each quadrant (BPNBS encoding).
*   **Entity Registries**: A complete dump of global arrays (`npcs`, `stars_data`, `planets`, `bases`), preserving relative coordinates, energy levels, and cooldown timers.
*   **Data Integrity**: Implements rigid version control (`GALAXY_VERSION`). If the server detects a file generated with different structural parameters (e.g., max NPC number changed), it invalidates the load to prevent memory corruption, regenerating a consistent universe.

#### üîÑ Synchronization Pipeline (Auto-Save)
Continuity is guaranteed by an asynchronous synchronization loop:
*   **Periodic Flush**: Every 60 seconds, the logic thread initiates a save procedure.
*   **Thread Safety**: During disk I/O operation, the system acquires the `game_mutex`. This ensures the saved database is an **atomic snapshot** and consistent representation of the entire universe at that precise moment.

#### üÜî Identity and Profile Restoration
The player continuity system relies on **Persistent Identity**:
*   **Recognition**: By entering the same captain name used previously, the server queries the database of active and historical players.
*   **Session Recovery**: Instantly restores:
    *   **Global Coordinates (`gx, gy, gz`)**: The ship reappears exactly in the last visited sector.
    *   **Strategic Inventory**: Dilithium, Tritanium, and Isolinear Crystal levels in Cargo Bay.
    *   **Systems State**: Engine damage, sensor efficiency, and phaser bank charge.
*   **Connection Hot-Swap**: If a captain loses connection (client crash or network instability), the server keeps the vessel "active" but stationary for a grace period, allowing the player to regain immediate control upon reentry.

#### üÜò EMERGENCY RESCUE Protocol
In case of vessel destruction or fatal collision, upon re-entry Starfleet Command will initiate an automatic rescue mission, repositioning the ship in a safe sector and restoring core systems.
*   **Systems Restoration**: Emergency repair of all core subsystems and **Hull Integrity** up to **80% integrity**.
*   **Energy Recharge**: Supply of **9,999,999 units** of emergency energy.
*   **Ammunition Resupply**: Full reload of **1,000 photon torpedoes**.
*   **Safe Relocation**: Automatic jump to a random quadrant, with a safety check to **avoid active supernovas** and collision zones. Ships are positioned at sector center (5.0, 5.0, 5.0).
*   **Rescue Crew**: If personnel was at zero, a minimum rescue team of **100 members** is assigned.
    This architecture guarantees that Star Trek Ultra is not just a game session, but a true evolving space career.

## üîê Subspace Encryption: Tactical Deep Dive

Star Trek Ultra implements a multi-layered cryptographic suite, mapping real-world standards to the geopolitical landscape of the Alpha and Beta Quadrants.

### ‚öõÔ∏è Post-Quantum & Modern Standards (Federation Core)
*   **ML-KEM-1024 (Kyber)**: `enc pqc`. The pinnacle of subspace security. Standardized by NIST to resist Shor's algorithm, this protocol ensures that communications remain private even against future Quantum Computers. *Used by: Section 31 and Advanced Starfleet Research.*
*   **AES-256-GCM**: `enc aes`. The official Starfleet Command standard. Provides high-speed hardware-accelerated encryption with built-in message integrity (Authenticated Encryption).
*   **ChaCha20-Poly1305**: `enc chacha`. A modern, high-performance stream cipher. Ideal for scout ships and tactical links where software-side speed is critical.
*   **ARIA-256-GCM**: `enc aria`. A robust block cipher (South Korean standard). In-game, it represents the joint encryption standard used by the Federation-Klingon Alliance during large-scale operations.

### üèõÔ∏è Imperial & Regional Standards (Great Powers)
*   **Camellia-256-CTR**: `enc camellia`. A high-security ISO-certified cipher from Earth's past. Within the simulator, it acts as the **Romulan Star Empire Imperial Standard**, known for its elegance and resistance to brute-force decryption.
*   **Blowfish-CBC**: `enc bf`. Designed by Bruce Schneier, this algorithm is fast and has no known major weaknesses. Mapped to the **Ferengi Commerce Protocol**, optimized for protecting financial transactions and latinum trade routes.
*   **RC4 Stream**: `enc rc4`. A lightweight, variable-key-size stream cipher. Used as the **Tactical Low-Latency Link**, perfect for high-speed combat maneuvers where every millisecond counts.

### üè∫ Legacy & Resistance Protocols (History & Underworld)
*   **CAST5-CBC**: `enc cast`. A solid Canadian standard. Represents the **Old Republic Era** (22nd Century) encryption, still found in some remote starbases and civilian freighters.
*   **IDEA-CBC**: `enc idea`. Famous for its role in early PGP (Pretty Good Privacy). Mapped to the **Maquis Resistance**, used by rebels and independent colonies to evade Cardassian and Federation surveillance.
*   **Triple DES (3DES-CBC)**: `enc 3des`. An evolution of the original DES. Acts as the **Ancient Federation Archive** protocol, used for decrypting legacy 23rd-century data logs.
*   **DES-CBC**: `enc des`. The 1970s Earth standard. Mapped to **Pre-Warp Human Signals**, used by ancient sleeper ships and probes (like Voyager 6 or the Pioneer missions).

---

### üåê Real-World Cryptographic Analysis

For the interested engineer, here is the technical breakdown of the algorithms utilized in the project:

| Algorithm | Type | Key Size | Mode | Technical Profile |
| :--- | :--- | :--- | :--- | :--- |
| **ML-KEM (Kyber)** | Lattice-based (KEM) | 1024 (equiv) | Handshake | **NIST Post-Quantum Standard**. Designed to resist attacks from future quantum computers using the Module-Learning with Errors (M-LWE) mathematical problem. |
| **AES-256** | Block Cipher (SPN) | 256-bit | GCM | **The Global Standard**. Implements a Substitution-Permutation Network. GCM mode provides AEAD (Authenticated Encryption with Associated Data), ensuring both secrecy and integrity. |
| **ChaCha20** | Stream Cipher (ARX) | 256-bit | Poly1305 | **High-Performance Streamer**. Developed by Daniel J. Bernstein, it uses Add-Rotate-XOR operations. It is immune to timing attacks common in software-based AES implementations. |
| **ARIA** | Block Cipher (SPN) | 256-bit | GCM | **South Korean Standard**. Similar to AES but uses a different MDS matrix and S-box design. Provides excellent security diversity. |
| **Camellia** | Block Cipher (Feistel) | 256-bit | CTR | **Japanese ISO/IEC Standard**. Jointly developed by Mitsubishi and NTT. It is one of the few ciphers besides AES approved for high-level government use in several countries. |
| **Blowfish** | Block Cipher (Feistel) | 32-448 bit | CBC | **Legacy Classic**. Created by Bruce Schneier in 1993. While fast, its 64-bit block size makes it susceptible to birthday attacks on large data volumes (terabytes). |
| **RC4** | Stream Cipher | Variable | Stream | **Historically Significant**. Once the most widely used stream cipher (SSL/WEP), it is now deprecated due to statistical biases in the initial bytes of the keystream. |
| **CAST5** | Block Cipher (Feistel) | 128-bit | CBC | **PGP Standard**. Known for its resistance to differential and linear cryptanalysis. Widely used in open-source security tools. |
| **IDEA** | Block Cipher | 128-bit | CBC | **Swiss Design**. Based on the concept of mixing operations from different algebraic groups (XOR, Addition, Multiplication). Very popular in the early 1990s. |
| **3DES** | Block Cipher | 168-bit | CBC | **Legacy Transition**. Applies the DES algorithm three times. While it effectively increases key length, it is significantly slower than modern alternatives. |
| **DES** | Block Cipher | 56-bit | CBC | **The 1977 Legend**. The first global encryption standard. It is now considered insecure because its 56-bit key can be brute-forced in hours by modern hardware. |

---

## üõ†Ô∏è Technologies and System Requirements

The Star Trek Ultra project is a demonstration of performance-oriented software engineering, utilizing the latest evolutions of the C language and Linux/POSIX system interfaces.

### üèóÔ∏è Core Engine & Language Standards
*   **C23 (ISO/IEC 9899:2024)**: The simulator adopts the latest C language standard.
*   **Subspace Security (OpenSSL)**: All text communications and LCARS reports are protected by military-grade encryption via the OpenSSL library. The system supports a vast array of algorithms (**AES-256-GCM**, **ChaCha20**, **ARIA**, **Camellia**, **Blowfish**, **RC4**, **CAST5**, **IDEA**, **3DES**, and **ML-KEM-1024**) and implements **Rotating Frequency Codes****: each message's IV is synchronized with the server's `frame_id`, ensuring unique cryptographic signatures per tick and eliminating replay-attack risks.
*   **High-Performance Event Loop (`epoll`)**: The server uses Linux epoll to handle hundreds of simultaneous connections with minimal latency.
*   **Binary Protocol Efficiency**: Communication in the *Subspace Channel* is optimized via `pragma pack(1)`. This forces the compiler to eliminate any padding bytes between structure members, ensuring binary packets are as small as possible and portable across different architectures.
*   **Extended Messaging Buffers**: The protocol supports text payloads up to **64KB** per packet, allowing the transmission of full sensor reports (`srs`) even in very high-density quadrants.
*   **Hybrid Memory Management**: While the core engine uses static memory for speed, the client adopts **Dynamic Allocation (Heap)** for handling large asynchronous messages, preventing stack overflow risks and ensuring maximum stability for the listener thread.

### üßµ Concurrency and Real-Time IPC
*   **Zero-Copy Shared Memory**: The *Direct Bridge* architecture exploits **POSIX Shared Memory (`shm_open`)** and **mmap**. This allows sharing the entire galactic state between Client and Viewer without any memory copy operation (Zero-Copy), reducing IPC latency to nanosecond levels.
*   **Deterministic Synchronization**: The system uses a mix of **Pthread Mutex Shared** (for atomic data integrity) and **POSIX Semaphores** (for event-driven wake-up). This ensures the viewer renders data exactly when received from the server, eliminating visual jitter.
*   **High-Precision Timers**: The server logic loop is timed via `clock_nanosleep` on system monotonic clocks, ensuring physics and movement calculation is constant and independent of system load.

### üé® Tactical Rendering Pipeline (Cinematic Engine 2026)
Tactical visualization is managed by an advanced OpenGL engine implementing a modern multi-stage rendering pipeline:

*   **MSAA-aware FBO Pipeline**: The engine utilizes a multi-framebuffer architecture. The scene is first rendered into an **MSAA Target (4x Multisample)** at 16-bit floating point, then resolved via `glBlitFramebuffer` to ensure flawless antialiasing even with active post-processing effects.
*   **Post-Processing Bloom (HDR)**: Implements a dual-pass Gaussian Blur filter applied to light sources. This allows stars, phasers, engines, and explosions to emit a realistic glow that saturates the surrounding environment.
*   **Procedural Hull Shader (Triplanar Mapping)**: Ships and celestial bodies do not use static textures but a procedural shader that generates metallic plating and structural details in real-time. **Triplanar Mapping** ensures coherent detail projection without UV distortion on complex models.
*   **Dynamic Stellar Lighting**: The quadrant's primary light is dynamic; it is calculated in real-time based on the position of the nearest star, influencing shading and specular reflections on ship hulls.
*   **Procedural Nebula Skybox**: Deep space is rendered via a shader generating volumetric procedural nebulae (Noise-based), eliminating flat black backgrounds and providing a sense of depth and galactic scale.
*   **Advanced FX Particle System**: Manages thousands of particles via **Point Sprites** and dedicated shaders for explosions, engine trails, and space debris, featuring additive blending and atomic life decay.
*   **Radiant Photon Torpedoes**: Photon torpedoes feature an advanced multi-layered design: a central black singularity surrounded by a solid white geometric nucleus with dynamic lighting, six high-visibility kinetic rays (Star-Flares), and a particle trail, all synchronized in a dynamic rainbow color cycle (Rainbow Engine).
*   **Precision Combat Collision**: The server logic has been optimized for surgical-grade torpedo impact calculation. Explosions, including lethal hits resulting in vessel destruction, are now generated at the exact point of impact on the ship's surface rather than defaulting to its geometric center.
*   **Localized Sector Shields**: Implementation of intelligent 6-sector defensive shields. Instead of a generic bubble, the system displays localized "impact arcs" (wireframe tori) specifically on the hit quadrant (F, R, T, B, L, RI). The effect is temporally synchronized with phaser beam duration and has been calibrated for millimeter precision against vertical and ballistic trajectories from orbital defense platforms.
*   **Hull Impact Feedback (Red Pulse)**: When damage bypasses shields and strikes the hull directly, the vessel emits a warning red flash (Red Alert Pulse) via a dedicated shader and generates volumetric metallic sparks, providing immediate visual feedback on critical damage.
*   **Dual-Coordinate Phaser Tracking**: The phaser tracking system has been evolved to handle independent origin and destination vectors. This allows the visualizer to correctly render beams originating from NPC platforms or other players, ensuring the visual angle of the attack exactly matches the spatial position of the aggressor.
*   **Gravitational Lensing**: Black Holes implement real space-time distortion. The shader samples the scene texture and distorts pixels based on the mathematically calculated gravitational curvature (Einstein Lens).
*   **GLSL Shader Engine**: All core effects (star glow, wormhole distortion, cloaking) are processed on the GPU via optimized GLSL shaders.
*   **Vertex Buffer Objects (VBO)**: Static geometry is loaded into video memory to maximize graphic throughput.
*   **Projective HUD Technology**: Uses inverse matrix transformations and a **Matrix-Capture** system to anchor identification tags above moving vessels. The engine captures the 3D camera state in real-time and projects data into a hybrid 2D/3D space.
*   **Final UI Pass (Sharp Text)**: To ensure maximum legibility, the HUD and telemetry are rendered in a final pass after MSAA and Bloom processing. This bypasses cinematic blur filters, ensuring crystal-clear, ultra-defined text at any resolution.
*   **Intelligent Tactical Overlay**: When a target is locked (`lock <ID>`), a central augmented reality display provides deep-scan telemetry:
    *   **Absolute Energy Analysis**: Shows exact energy units remaining (not just percentage) to calculate lethal phaser yields.
    *   **IFF Identification**: Displays the target's faction (Federation, Klingon, Romulan, etc.) with color-coded alerts.
    *   **Motion Tracking**: Real-time display of target Heading and Mark to predict evasion maneuvers.
    *   **Dynamic Rangefinding**: Continuous distance calculation for optimal weapons range management.
    *   **Subspace Probe Tracking**: A dedicated **PROBES STATUS** panel monitors active probes, showing their current mission phase (En Route / Transmitting), target coordinates, and remaining travel time (ETA).

### üì¶ Dependencies and Compilation
To compile the project, a Unix-like development environment (preferably Linux) is required with the following requirements:
*   **Compiler**: GCC 13+ or Clang 16+ (for full C23 support).
*   **Libraries**:
    *   `freeglut3` and `libglu1-mesa` (for the viewer).
    *   `librt` and `libpthread` (for SHM and multithreading).

#### Ubuntu / Debian
```bash
sudo apt-get install build-essential freeglut3-dev libglu1-mesa-dev libglew-dev libssl-dev
```

#### Fedora / Red Hat / AlmaLinux / CentOS
```bash
sudo dnf groupinstall "Development Tools"
sudo dnf install freeglut-devel mesa-libGLU-devel glew-devel openssl-devel
```

---

## üõ†Ô∏è Software Engineering Deep Dive

### üìê System Architecture and Design Patterns
The project implements several advanced engineering solutions to handle real-time simulation:

*   **O(1) Spatial Indexing**: The galaxy is managed via a 3D "bucket" spatial partitioning grid. Every quadrant is indexed in a `spatial_index[11][11][11]` structure, allowing instantaneous lookup of nearby objects and reducing the computational complexity of collision detection from $O(N^2)$ to $O(1)$ per sector.
*   **Memory Safety & Allocation**: The core engine adopts a **Zero-Allocation** policy during the game loop. All buffers (NPCs, projectiles, particles) are pre-allocated at boot. This totally eliminates memory leak risks and frame drops caused by dynamic memory management during intensive sessions.
*   **Bit-Packed State Encoding (BPNBS)**: To optimize network traffic, the synthetic state of each quadrant is encoded into a 64-bit integer (`long long`). Each digit or bit group represents an object category (BlackHole, Planet, NPC, Base, Star), allowing global galactic map updates with an overhead of just a few bytes.
*   **Atomic Broadcast Pattern**: To ensure multi-player consistency, the server implements atomic update transmission. During broadcast, the galactic state is locked globally, ensuring each client receives an identical and synchronized data frame, eliminating ghosting or discrepancies between captains.
*   **Real-Time Network Diagnostics**: The system doesn't just receive data; it analyzes signal quality by calculating **Pulse Jitter** (standard deviation of inter-frame arrival time) and **Signal Integrity**. These metrics allow real-time monitoring of simulation fluidity and binary protocol health.
*   **Authoritative Multi-Channel Synchronization**: For cataclysmic events like Supernovas, the client implements a dual-validation logic. it cross-references real-time event packets with grid-encoded state data. This prevents "stuck" timers and ensures that the countdown remains accurate and synchronized even during high-speed quadrant transitions.
*   **Data Integrity & Heuristic Filtering**: The viewer implements real-time validation algorithms to distinguish between structural quadrant data (BPNBS) and emergency temporal signals. This prevents display anomalies (such as out-of-range timers) by filtering stale or corrupt data during network handovers.
*   **Zero-Latency Protocol Switching**: The encryption system supports instantaneous state changes.
 The client synchronizes its decryption state a fraction of a second before sending the command to the server, ensuring that even immediate response messages (Handshakes) are correctly processed without informational glitches.
*   **Fixed Timestep Logic**: The server processes physics at a fixed 30Hz tick-rate (`clock_nanosleep`), while network health is monitored in real-time via a telemetry engine that calculates throughput and packets per second (PPS) to ensure a stable connection.

---
*STARTREK ULTRA - 3D LOGIC ENGINE. Developed with technical excellence by Nicola Taibi*
